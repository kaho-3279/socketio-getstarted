<!DOCTYPE html>
<html>

<head>
  <title>NP button</title>
  <link rel="stylesheet" type="text/css" href="./index.css">
  <meta name="viewport" content="width=300" >
</head>
<style>
  ul{
  list-style: none;
  padding-left: 0;
}

html{
  font-size: 62.5%;
}


body {
  margin: 0;
  padding: 0;
  padding-bottom: 3rem;
  text-align:center;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  min-width:200px;
  font-size: 1.6rem;
  -webkit-text-size-adjust : 100% ;
}


main{
  margin-left:auto;
  margin-right:auto;
  text-align:left;
  max-width:600px;
}

#wrap { 
  overflow : hidden ; 
}

/*.btn-slip {
  display: inline-block;
  padding: 12px 12px;
  font-weight: bold;
  border-radius: 4px;
  background-color: #6A91C1;
  box-shadow: 0px 2px 2px 1px #CCCCCC;
  border-bottom: solid 5px #516C8D;
  -webkit-transition: none;
  transition: none;
  color: #fff;

}

.btn-slip:active {
  box-shadow: none;
  position: relative;
  border-bottom: none;
  top: 7px;
}*/

.btn {
  color: 
#fff;
    background: 
rgba(127, 194, 239, .5);
    padding: .3em .5em;
    margin-bottom: .3em;
    border-radius: .3em;
    text-align: center;
    display: table; 
}

.btn:hover {
    cursor: pointer;    
}
.btn:active {
  background: 
rgb(127, 194, 239);
}

.add-control .chk{
    display: none;
}

/* button control */
.add-control #npbutton ~ .box {
    display: none ;
}
.add-control #npbutton ~ .btn-open-close .open {
    display: inline;
}
.add-control #npbutton ~ .btn-open-close .close {
    display: none;
}
.add-control #npbutton:checked ~ .btn-open-close .open {
    display: none;
}
.add-control #npbutton:checked ~ .btn-open-close .close {
    display: inline;
}

</style>

<body>
  <ul id="loggedInUsers"></ul>
  <div class="add-control">
    <input type="checkbox" class="chk" id="npbutton" name="btn"><label class="btn btn-open-close" for="open-close"><span class="open">意見ありません</span><span class="close">復活</span></label>
</div>
  <div class="progress">
    <progress id="p1" value="100" max="100">0%</progress>
  </div>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

  <script>
    var socket = io();
    var input = document.getElementById('input');

    var name = prompt("学籍番号と名前を入力してください");
    if (name == "") name = "unknown";
    if (name == "null") name = "unknown";
    socket.emit("nickname", name);
    alert('こんにちは' + name + 'さん！');
    //alert('ボタンをクリックすると自分の名前が非表示になります。意見がないときに押してください。30秒経過orダブルクリックで再表示');



    socket.on('loggedInUsers', function (onlineUsers) {

      const parent = document.getElementById('loggedInUsers');
      while (parent.firstChild) {
        parent.removeChild(parent.firstChild);
      };

      onlineUsers.sort(function(){
        return Math.random() - Math.random();
      });

      for (let item of onlineUsers) {
        const li = `<li id="${item.id}">${item.name}</li>`;
        console.log(item);


        document.getElementById('loggedInUsers').insertAdjacentHTML('beforeend', li);


      }
    });


    socket.on('namelist', function (data) {

    });


    const btn = document.getElementById('npbutton');

    function proc1(){
      btn.disabled = true;
      if (document.getElementById('p1').value > 0 ) {
		document.getElementById('p1').value--;
		setTimeout(proc1, 300);

	}else{
    btn.disabled = false;
    document.getElementById('p1').value = 100;
  }
}



    btn.addEventListener("click", e => {

      socket.emit('NoOpinions')

      console.log('click');


    });
  



    btn.addEventListener("dblclick", e => {

      socket.emit('HaveOpinions')


      console.log('dblclick');

    });



    socket.on('NoOpinions', (u) => {
      console.log(u);

      const visible = function () {
        li.style.visibility = 'visible';

      };

      const li = document.getElementById(u.id);
      li.style.visibility = 'hidden';
      //li.style.opacity = 0;

      setTimeout(visible, 30000);

    });


    socket.on('HaveOpinions', (u) => {
      const li = document.getElementById(u.id);
      li.style.visibility = 'visible';
    });




  </script>
</body>

</html>