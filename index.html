<!DOCTYPE html>
<html>

<head>
  <title>NP button</title>
  <link rel="stylesheet" type="text/css" href="./index.css">
  <meta name="viewport" content="width=300">
</head>
<style>
  ul {
    list-style: none;
    padding-left: 0;
  }

  html {
    font-size: 62.5%;
  }


  body {
    margin: 0;
    padding: 0;
    padding-bottom: 3rem;
    text-align: center;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    min-width: 200px;
    font-size: 1.6rem;
    -webkit-text-size-adjust: 100%;
  }


  main {
    margin-left: auto;
    margin-right: auto;
    text-align: left;
    max-width: 600px;
  }

  #wrap {
    overflow: hidden;
  }

  /*.btn-slip {
  display: inline-block;
  padding: 12px 12px;
  font-weight: bold;
  border-radius: 4px;
  background-color: #6A91C1;
  box-shadow: 0px 2px 2px 1px #CCCCCC;
  border-bottom: solid 5px #516C8D;
  -webkit-transition: none;
  transition: none;
  color: #fff;

}

.btn-slip:active {
  box-shadow: none;
  position: relative;
  border-bottom: none;
  top: 7px;
}*/

  .btn {
    display: inline-block;
    padding: 12px 12px;
    font-weight: bold;
    border-radius: 4px;
    background-color: #6A91C1;
    box-shadow: 0px 2px 2px 1px #CCCCCC;
    border-bottom: solid 5px #516C8D;
    -webkit-transition: none;
    transition: none;
    color: #fff;
  }

  .btn:hover {
    cursor: pointer;
  }

  .btn:active {
    box-shadow: none;
    position: relative;
    border-bottom: none;
    top: 7px;
  }

  /* radio non-display */
  .add-control .radio {
    display: none;
  }

  /* button control */
  .add-control #pbutton:checked~.btn-pbutton {
    display: none;
  }

  .add-control #pbutton:checked~.btn-npbutton {
    display: table;
  }

  .add-control #npbutton:checked~.btn-pbutton {
    display: table;
    display: inline-block;
    padding: 12px 20px;
    font-weight: bold;
    border-radius: 4px;
    background-color: #EB902A;
    box-shadow: 0px 2px 2px 1px #CCCCCC;
    border-bottom: solid 5px #AB691F;
    -webkit-transition: none;
    transition: none;
    color: #fff;
  }

  .add-control #npbutton:checked~.btn-pbutton:active{
    box-shadow: none;
    position: relative;
    border-bottom: none;
    top: 7px;
  }

  .add-control #npbutton:checked~.btn-npbutton {
    display: none;
  }
</style>

<body>
  <ul id="loggedInUsers"></ul>
  <div class="add-control">
    <input type="radio" class="radio" id="npbutton" name="btn" onclick="proc1();" /><label class="btn btn-npbutton"
      for="npbutton">意見ありません</label>
    <input type="radio" class="radio" id="pbutton" name="btn" checked="checked" onclick="proc2();" /> <label
      class="btn btn-pbutton" for="pbutton">復活</label>
  </div>
  <div class="progress">
    <progress id="p1" value="100" max="100">0%</progress>
  </div>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.14.2/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min.js"></script>

  <script>
    var socket = io();
    var input = document.getElementById('input');
    //var intervalID;

    var name = prompt("学籍番号と名前を入力してください");
    if (name == "") name = "unknown";
    if (name == "null") name = "unknown";
    socket.emit("nickname", name);
    alert('こんにちは' + name + 'さん！');
    //alert('ボタンをクリックすると自分の名前が非表示になります。意見がないときに押してください。30秒経過orダブルクリックで再表示');



    socket.on('loggedInUsers', function (onlineUsers) {

      const parent = document.getElementById('loggedInUsers');
      while (parent.firstChild) {
        parent.removeChild(parent.firstChild);
      };

      onlineUsers.sort(function () {
        return Math.random() - Math.random();
      });

      for (let item of onlineUsers) {
        const li = `<li id="${item.id}">${item.name}</li>`;
        console.log(item);


        document.getElementById('loggedInUsers').insertAdjacentHTML('beforeend', li);


      }
    });

//ここから

    function sheet_to_workbook(sheet/*:Worksheet*/, opts)/*:Workbook*/ {
      var n = opts && opts.sheet ? opts.sheet : "Sheet1";
      var sheets = {}; sheets[n] = sheet;
      return { SheetNames: [n], Sheets: sheets };
    }

    function s2ab(s) {
      var buf = new ArrayBuffer(s.length);
      var view = new Uint8Array(buf);
      for (var i = 0; i != s.length; ++i) view[i] = s.charCodeAt(i) & 0xFF;
        return buf;
      }

      function func1() {
        var write_opts = {
      type: 'binary'
    };

    var wb = aoa_to_workbook(onlineUsers);
    var wb_out = XLSX.write(wb, write_opts);

    var blob = new Blob([s2ab(wb_out)], { type: 'application/octet-stream' });

    saveAs(blob, 'myExcelFile.xlsx');
  }

//ここまで


    socket.on('namelist', function (data) {

    });


    const btn = document.getElementById('npbutton');
    const btn2 = document.getElementById('pbutton');

    function proc1() {
      //btn.disabled = true;
      if (document.getElementById('p1').value > 0) {
        document.getElementById('p1').value--;
        setTimeout(proc1, 300);

      } else {
        //btn.disabled = false;
        document.getElementById('p1').value == 100;
      }
      //if (document.getElementById('p1').value == 100){
      //clearInterval(intervalID);
      //}
    }

    function proc2() {
      document.getElementById('p1').value == 100;
    }



    btn.addEventListener("click", e => {

      socket.emit('NoOpinions')

      console.log('click');


    });

    btn2.addEventListener("click", e => {

      socket.emit('ShowName')

    });




    //btn.addEventListener("dblclick", e => {

      //socket.emit('HaveOpinions')


     // console.log('dblclick');

    //});



    socket.on('NoOpinions', (u) => {
      console.log(u);

      const visible = function () {
        li.style.visibility = 'visible';

        // const btn = document.getElementById('npbutton');
        //btn.style.visibility = 'visible';

      };

      const li = document.getElementById(u.id);
      li.style.visibility = 'hidden';
      //li.style.opacity = 0;

      setTimeout(visible, 30000);

      //btn.style.visibility = 'visible';
      //btn2.style.visibility = 'hidden';

    });

    socket.on('ShowName', (u) => {
      const li = document.getElementById(u.id);
      li.style.visibility = 'visible';


    });


   // socket.on('HaveOpinions', (u) => {
     // const li = document.getElementById(u.id);
      //li.style.visibility = 'visible';
    //});




  </script>
</body>

</html>